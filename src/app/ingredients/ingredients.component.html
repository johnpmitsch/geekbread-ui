<div class="alert alert-danger alert-dismissible" role="alert" *ngIf="errorMessage">
<button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
  {{errorMessage}}
</div>

<div class='well well-sm'>
  Total Dough Weight(grams): <input #totalWeight (keyup.enter)="submitTotalDoughWeight(totalWeight.value)" placeholder="Enter weight"/>
<button (click)= "submitTotalDoughWeight(totalWeight.value)" class="btn btn-primary btn-sm">Calculate</button>
</div>

<table class="table table-striped table-responsive">
  <thead>
    <td><em>Ingredient</em></td>
    <td><em>Flour?</em></td>
    <td><em>Percentage</em></td>
    <td><em>Amount(grams)</em></td>
    <td><em>Action</em></td>
  </thead>
  <tbody>
    <div *ngIf="ingredients === nil">
      <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
    </div>     
    <tr *ngFor="let ingredient of ingredients">
      <td>{{ ingredient.name }}</td>
      <td><i *ngIf="ingredient.type == 'Flour'" class="fa fa-check" aria-hidden="true"></i>  
      <td>{{ ingredient.percentage | number:'1.0-1'}}%</td>
      <td><b>{{ ingredient.amount | number:'1.0-0' }}</b></td>
      <td>
        <button	class="btn btn-default btn-sm" 
                data-toggle="modal"
                [attr.data-target]="'#edit' + ingredient.id">
          Edit
        </button>
        <button	class="btn btn-danger btn-sm" 
                data-toggle="modal"
                [attr.data-target]="'#delete' + ingredient.id">
          Delete
        </button>
      </td>

      <!-- Delete Ingredient Modal -->
      <div class="modal fade" [attr.id]="'delete' + ingredient.id" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="deleteModalLabel">Confirm Delete</h4>
            </div>
            <div class="modal-body">
              Are you sure you want to delete {{ ingredient.name }}?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="deleteIngredient(ingredient.id)">Delete</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Update Ingredient Modal -->
      <div class="modal fade" [attr.id]="'edit' + ingredient.id" tabindex="-1" role="dialog" aria-labelledby="editModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="deleteModalLabel">Edit Ingredient</h4>
            </div>
            <div class="modal-body">
              <div>
                  <label for="name">Name</label>
                  <input type="text"
                         #ingredientName
                         [value]="ingredient.name">        
              </div>
              <div>
                <label for="percentage">Percentage</label>
                <input type="text"
                       #ingredientPercentage
                       [value]="ingredient.percentage">
              </div>
              <div>
                <label for="type">Type</label>
                <select #ingredientType
                       [value]="ingredient.type">
                   <option value="Flour">flour</option>     
                   <option value="Other">non-flour</option>     
                </select>      
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" 
                      class="btn btn-success"
                      data-dismiss="modal"
                      (click)="updateIngredient(ingredient.id, ingredientName.value, ingredientPercentage.value, ingredientType.value)">
                Update Ingredient
              </button>
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </tr>
  </tbody>
</table>
<div *ngIf="ingredients && ingredients.length < 1" class="alert alert-info">
  You can add ingredients to this recipe below. When you are done you can enter the total dough weight above and calculate your beautiful bread! Recipes are saved automatically
</div>

<div class="well well-sm">
  <ingredient-form [recipe]="recipe" (notify)="updateIngredients($event)"></ingredient-form>
</div>
